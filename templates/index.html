<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EV Charging Station Finder âš¡</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <style>
    /* === Futuristic Gradient Background === */
    body {
      margin: 0;
      padding: 0;
      font-family: "Poppins", sans-serif;
      background: radial-gradient(circle at top left, #0f2027, #203a43, #2c5364);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #e0f7fa;
      overflow: hidden;
    }

    /* === Floating animation background lights === */
    .glow {
      position: absolute;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: rgba(0, 255, 170, 0.2);
      filter: blur(100px);
      animation: float 10s infinite ease-in-out alternate;
    }

    .glow:nth-child(1) {
      top: -100px;
      left: -100px;
      background: rgba(0, 255, 170, 0.3);
    }
    .glow:nth-child(2) {
      bottom: -100px;
      right: -150px;
      background: rgba(0, 200, 255, 0.3);
    }

    @keyframes float {
      from {
        transform: translateY(0px);
      }
      to {
        transform: translateY(40px);
      }
    }

    /* === Main container card === */
    .container {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 40px 50px;
      text-align: center;
      box-shadow: 0 0 20px rgba(0, 255, 170, 0.1);
      width: 400px;
      z-index: 2;
      animation: fadeIn 1s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* === Heading === */
    h1 {
      font-size: 1.8em;
      margin-bottom: 10px;
      color: #00ffaa;
      text-shadow: 0 0 10px #00ffaa;
    }

    p {
      color: #aef5f5;
      margin-bottom: 25px;
      font-size: 0.95em;
    }

    /* === Input fields === */
    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 12px 15px;
      margin: 10px 0;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: #e0f7fa;
      font-size: 1em;
      outline: none;
      transition: all 0.3s;
    }

    input[type="text"]:focus, input[type="number"]:focus {
      box-shadow: 0 0 10px #00ffaa;
      background: rgba(255, 255, 255, 0.15);
    }

    /* === Button === */
    button {
      background: linear-gradient(90deg, #00ffaa, #00bfff);
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      color: #0a192f;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
      width: 100%;
      font-size: 1em;
      box-shadow: 0 0 15px rgba(0, 255, 170, 0.3);
    }

    button:hover {
      background: linear-gradient(90deg, #00bfff, #00ffaa);
      box-shadow: 0 0 20px #00ffaa;
    }

    /* === Divider === */
    .divider {
      margin: 20px 0;
      color: #7de2d1;
      font-size: 0.9em;
    }

    label {
      display: block;
      text-align: left;
      color: #aef5f5;
      margin-top: 10px;
      font-size: 0.9em;
    }

    /* Floating chat (right side) */
    .chat-toggle{position:fixed;right:22px;bottom:22px;z-index:120;background:linear-gradient(90deg,#2fe8c6,#00c9ff);border:none;color:#002826;padding:12px;border-radius:999px;box-shadow:0 12px 40px rgba(0,0,0,0.6);cursor:pointer;font-size:18px}
    .chat-panel{position:fixed;right:22px;bottom:86px;width:380px;max-height:72vh;background:rgba(2,18,16,0.95);color:#cfeee6;border-radius:12px;padding:12px;box-shadow:0 24px 60px rgba(0,0,0,0.6);display:none;flex-direction:column;z-index:120}
    .chat-messages{flex:1;overflow:auto;padding:6px;display:flex;flex-direction:column;gap:8px}
    .chat-input{display:flex;gap:8px;margin-top:8px}
    .chat-input textarea{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#cfeee6;resize:none}
    .chat-send{background:#2fe8c6;border:none;padding:8px 10px;border-radius:8px;color:#002826;font-weight:700;cursor:pointer}
  </style>
</head>

<body>
  <main>
    <div class="ev-finder-root" style="min-height:100vh; display:flex; align-items:center; justify-content:center; padding:32px;">
      <div class="ev-card" style="width:100%; max-width:480px; background:rgba(7,15,13,0.7); border-radius:28px; padding:28px; box-shadow:0 20px 60px rgba(2,18,16,0.6);">
        <div style="text-align:center; margin-bottom:18px;">
          <div style="display:flex; align-items:center; justify-content:center; gap:10px; margin-bottom:12px;">
            <div style="font-size:32px; color:#2fe8c6;">âš¡</div>
            <h1 style="margin:0; font-size:24px; color:#2fe8c6;">EV Charging Station Finder</h1>
          </div>
          <p style="color:#cfeee6; margin:0; font-size:14px;">Enter your location details to find the nearest charging stations.</p>
        </div>

        <form action="/results" method="POST" style="display:flex; flex-direction:column; gap:12px;">
          <div>
            <label style="display:block; color:#cfeee6; font-size:13px; margin-bottom:6px;">Enter Address:</label>
            <input name="address" type="text" placeholder="e.g., New York, USA" style="width:100%; padding:12px 14px; border-radius:10px; border:none; background:rgba(255,255,255,0.03); color:#e6fff9;" />
          </div>

          <div style="display:flex; align-items:center; gap:10px;">
            <div style="flex:1; height:1px; background:rgba(255,255,255,0.05);"></div>
            <div style="color:#9feee0; font-size:12px;">or</div>
            <div style="flex:1; height:1px; background:rgba(255,255,255,0.05);"></div>
          </div>

          <div>
            <label style="display:block; color:#cfeee6; font-size:13px; margin-bottom:6px;">Latitude:</label>
            <input name="latitude" type="text" placeholder="e.g., 28.6139" style="width:100%; padding:12px 14px; border-radius:10px; border:none; background:rgba(255,255,255,0.03); color:#e6fff9;" />
          </div>

          <div>
            <label style="display:block; color:#cfeee6; font-size:13px; margin-bottom:6px;">Longitude:</label>
            <input name="longitude" type="text" placeholder="e.g., 77.2090" style="width:100%; padding:12px 14px; border-radius:10px; border:none; background:rgba(255,255,255,0.03); color:#e6fff9;" />
          </div>

          <div>
            <label style="display:block; color:#cfeee6; font-size:13px; margin-bottom:6px;">Number of nearest stations:</label>
            <input name="k" type="number" value="5" min="1" style="width:100%; padding:12px 14px; border-radius:10px; border:none; background:rgba(255,255,255,0.03); color:#e6fff9;" />
          </div>

          <button type="submit" style="width:100%; padding:12px 14px; border-radius:12px; background:linear-gradient(90deg,#2fe8c6,#00c9ff); color:#002826; font-weight:700; border:none; cursor:pointer;">Find Stations</button>
        </form>
      </div>
    </div>
  </main>
      
    </div>
  </div>

  <!-- Chat toggle & panel (home) -->
  <style>
    /* Chat panel sizing tweaks: wider textarea, compact send/close buttons */
    .chat-toggle{position:fixed;right:18px;bottom:18px;width:46px;height:46px;border-radius:999px;background:#2fe8c6;color:#002826;border:none;box-shadow:0 6px 18px rgba(0,0,0,0.25);font-size:20px;cursor:pointer}
    .chat-panel{display:none;position:fixed;right:18px;bottom:78px;width:360px;max-width:calc(100vw - 36px);flex-direction:column;background:linear-gradient(180deg,rgba(4,20,18,0.65),rgba(3,18,16,0.75));backdrop-filter: blur(6px);padding:12px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.45);color:#cfeee6}
    .chat-messages{overflow:auto;max-height:300px;padding-bottom:8px;margin-bottom:8px}
    .chat-input{display:flex;gap:8px;align-items:flex-end}
    .chat-input textarea{flex:1;min-height:48px;max-height:140px;resize:none;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:14px}
    .chat-send{width:52px;min-width:52px;padding:8px;border-radius:8px;border:none;background:#006650;color:#e6fff9;cursor:pointer}
    #chat-close{font-size:12px;padding:2px 4px;border-radius:6px;border:none;background:transparent;color:#cfeee6;cursor:pointer;width:28px;height:26px;display:inline-flex;align-items:center;justify-content:center}
    /* Make sure messages area shrinks properly on small screens */
    @media (max-width:420px){ .chat-panel{right:10px;left:10px;width:auto;bottom:72px} }
  </style>

  <button id="chat-toggle" class="chat-toggle" aria-label="Open chat">ðŸ’¬</button>
  <div id="chat-panel" class="chat-panel" role="dialog" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><strong>EV Assistant</strong><button id="chat-close">âœ–</button></div>
    <div id="chat-messages" class="chat-messages" aria-live="polite"><div style="font-size:12px;opacity:0.8">Ask about stations, directions, or tips.</div></div>
    <div class="chat-input"><textarea id="chat-input" rows="1" placeholder="Ask the EV Assistant..."></textarea><button id="chat-send" class="chat-send">Send</button></div>
  </div>

  <script>
    // reuse existing askChatbot if present, otherwise fallback
    async function askChatbotWrapper(msg){
      if (typeof askChatbot === 'function') return askChatbot(msg);
      try{
        const res = await fetch('/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg})});
        const data = await res.json();
        if (data.candidates) return data.candidates[0].content.parts[0].text;
        if (data.error) return 'âš ï¸ '+(data.error.message||data.error);
        return JSON.stringify(data);
      }catch(e){ return 'âš ï¸ Backend error.' }
    }

    // safely attach chat handlers only if the elements exist
    const toggleBtn = document.getElementById('chat-toggle');
    if (toggleBtn){
      const panel = document.getElementById('chat-panel');
      const closeBtn = document.getElementById('chat-close');
      const sendBtn = document.getElementById('chat-send');
      const input = document.getElementById('chat-input');
      const msgs = document.getElementById('chat-messages');

      function appendMsg(role, text){ const d=document.createElement('div'); d.style.padding='8px 10px'; d.style.borderRadius='10px'; d.style.maxWidth='78%'; d.style.fontSize='13px'; d.style.marginBottom='6px'; if(role==='user'){ d.style.marginLeft='auto'; d.style.background='#2fe8c6'; d.style.color='#002826'; } else { d.style.marginRight='auto'; d.style.background='rgba(255,255,255,0.03)'; d.style.color='#cfeee6'; } d.textContent=text; msgs.appendChild(d); msgs.scrollTop = msgs.scrollHeight; }

      toggleBtn.addEventListener('click', ()=>{ if (panel.style.display==='flex'){ panel.style.display='none'; panel.setAttribute('aria-hidden','true'); } else { panel.style.display='flex'; panel.setAttribute('aria-hidden','false'); input.focus(); } });
      closeBtn.addEventListener('click', ()=>{ panel.style.display='none'; panel.setAttribute('aria-hidden','true'); });

      sendBtn.addEventListener('click', async ()=>{ const t=input.value.trim(); if(!t) return; appendMsg('user', t); input.value=''; appendMsg('bot','...'); const res = await askChatbotWrapper(t); if (msgs.lastChild && msgs.lastChild.textContent==='...') msgs.lastChild.remove(); appendMsg('bot', res); });
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendBtn.click(); } });
    }
  </script>


</body>
</html>
